<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>James' French Game ‚Äî Simple & Fun</title>
<style>
  :root{
    --bg:#1b1f3a; --card:#222757; --ink:#ffffff; --soft:#c9d2ff; --good:#57e389; --bad:#ff6b6b; --edge:#3640a0;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
    background:radial-gradient(900px 600px at 10% -10%, #2a3377 0%, transparent 60%), var(--bg);
    color:var(--ink); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .app{max-width:900px; width:100%}
  .card{
    background:linear-gradient(180deg, #262b66, #1d2352);
    border:2px solid var(--edge); border-radius:18px; box-shadow:0 12px 28px rgba(0,0,0,.35);
    padding:16px;
  }
  header{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px}
  h1{margin:0; font-size:clamp(22px,4vw,32px)}
  .pill{background:#121642; border:1px solid #303a94; padding:6px 10px; border-radius:999px; color:var(--soft); font-weight:700}
  .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  button{
    appearance:none; cursor:pointer; border-radius:14px; font-weight:800; color:var(--ink);
    border:2px solid #3a46a8; background:linear-gradient(180deg, #2b3484, #232a66); padding:12px 16px;
    box-shadow:0 8px 18px rgba(0,0,0,.25); transition:transform .1s, filter .15s;
  }
  button:hover{ filter:brightness(1.05) }
  button:active{ transform:translateY(2px) }
  .bigbtn{font-size:clamp(18px,3.2vw,22px)}
  .smallbtn{font-size:14px; padding:8px 10px}
  .prompt{
    margin:8px 0 12px; font-size:clamp(20px,4.4vw,28px); font-weight:900;
    background:linear-gradient(90deg, #fff, #cfe5ff);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  .options{display:grid; grid-template-columns:1fr; gap:10px}
  @media (min-width:580px){ .options{grid-template-columns:1fr 1fr} }
  .option{font-size:clamp(18px,3.4vw,24px); text-align:center}
  .option.correct{background:linear-gradient(180deg, #1f5a3c, #17472f); border-color:#2f9a6e}
  .option.wrong{background:linear-gradient(180deg, #632a34, #4a2028); border-color:#b34a4a}
  .bar{display:flex; gap:10px; align-items:center; justify-content:space-between; margin:8px 0}
  .meter{flex:1; height:14px; border:2px solid var(--edge); border-radius:12px; overflow:hidden; background:#121642}
  .fill{height:100%; width:0%; background:linear-gradient(90deg, #62f3ff, #5be6a0)}
  .stats{font-weight:900; color:var(--soft)}
  .footer{display:flex; gap:8px; align-items:center; justify-content:space-between; margin-top:10px; color:var(--soft)}
  .tiny{font-size:12px}
  #fx{position:fixed; inset:0; pointer-events:none}

  /* --- CAR CRASH PRACTICE --- */
  .practice{
    margin-top:14px; border:2px solid var(--edge); border-radius:14px; padding:10px;
    background:linear-gradient(180deg, #242b6a, #1b2254);
  }
  .practice h3{margin:0 0 6px}
  .p-top{display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap}
  .p-info{font-weight:900; color:var(--soft)}
  #arena{
    position:relative; margin-top:8px; height:260px; overflow:hidden;
    border:2px solid #3a46a8; border-radius:12px;
    background:
      radial-gradient(400px 160px at 80% -20%, rgba(255,255,255,.12) 0%, transparent 60%),
      linear-gradient(180deg, #10153a, #121740 60%);
  }
  #bigMission{
    position:absolute; left:0; right:0; top:8px; text-align:center;
    font-weight:900; font-size:clamp(18px,4.6vw,28px); letter-spacing:1px;
    color:#ffe27a; text-shadow:0 2px 0 #000;
  }
  .road{position:absolute; left:0; right:0; bottom:46px; height:4px; background:linear-gradient(90deg, rgba(255,255,255,.2) 0 30%, transparent 30% 60%, rgba(255,255,255,.2) 60% 90%, transparent 90% 100%)}
  .car{
    position:absolute; bottom:6px; width:64px; height:32px; line-height:32px; text-align:center; font-size:26px;
    background:linear-gradient(180deg, #2b358f, #1f255f); border:2px solid #4f5be0; border-radius:10px;
    user-select:none;
  }
  .car::after{content:"üöó"; display:block; transform:translateY(-2px)}
  .word{
    position:absolute; top:-40px; padding:8px 12px; border-radius:999px; font-weight:900; white-space:nowrap;
    border:2px solid #4f5be0; background:linear-gradient(180deg, #2b358f, #212a6b);
    user-select:none; font-size:18px;
  }
  .word.bad{border-color:#4f5be0; background:linear-gradient(180deg, #2b358f, #212a6b)}
  .boom{
    position:absolute; pointer-events:none; font-size:32px; transform:scale(1); animation:pop .45s ease-out forwards;
  }
  @keyframes pop{ to { transform:scale(1.6); opacity:0; } }
  .controls{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .modebtn{padding:6px 10px; font-size:13px}

  /* --- MEMORY MATCH --- */
  .memory{
    margin-top:14px; border:2px solid var(--edge); border-radius:14px; padding:12px;
    background:linear-gradient(180deg, #202660, #181e4a);
  }
  .memory h3{margin:0 0 8px}
  .mem-top{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .mem-stats{font-weight:900; color:var(--soft)}
  .mem-controls{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  select{background:#121642; color:var(--soft); border:1px solid #303a94; border-radius:10px; padding:6px 10px; font-weight:700}
  #memGrid{
    margin-top:10px; display:grid; gap:8px; grid-template-columns:repeat(auto-fill, minmax(110px, 1fr));
    max-height:460px; overflow:auto; padding:4px;
    border:2px solid #303a94; border-radius:12px; background:linear-gradient(180deg, #161b4a, #121642);
  }
  .mem-card{
    position:relative; height:92px; perspective:700px; border-radius:12px;
  }
  .mem-card button{
    width:100%; height:100%; background:transparent; border:none; padding:0; cursor:pointer;
  }
  .mem-card .face{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    border-radius:12px; border:2px solid #3a46a8;
    backface-visibility:hidden; transform-style:preserve-3d; transition:transform .35s ease;
    text-align:center; padding:8px; font-weight:900;
  }
  .mem-card .front{
    background:linear-gradient(180deg, #2b3484, #232a66);
    color:#fff; font-size:20px;
  }
  .mem-card .back{
    transform:rotateY(180deg);
    background:linear-gradient(180deg, #24308a, #1b235f);
    color:#fff; font-size:16px;
  }
  .mem-card.flipped .front{ transform:rotateY(180deg); }
  .mem-card.flipped .back{ transform:rotateY(360deg); } /* shows back */
  .mem-card.matched .front, .mem-card.matched .back{
    border-color:#2f9a6e; box-shadow:0 0 0 2px rgba(47,154,110,.35) inset;
  }
  .mem-win{margin-top:8px; font-weight:900; color:#57e389}
</style>
</head>
<body>
<canvas id="fx"></canvas>
<div class="app card">
  <header>
    <h1>James' French Game</h1>
    <div class="pill">Tap an answer. Collect stars. Zero stress.</div>
  </header>

  <!-- ===== TOP QUIZ (unchanged logic, only labels) ===== -->
  <div class="row">
    <button id="dir" class="smallbtn">French ‚Üí English</button>
    <button id="reset" class="smallbtn">‚Üª Reset</button>
  </div>

  <div class="bar">
    <div class="meter"><div id="pFill" class="fill"></div></div>
    <div class="stats">‚≠ê <span id="stars">0</span> ¬∑ ‚ù§Ô∏è <span id="lives">3</span></div>
  </div>

  <div class="prompt" id="prompt">Ready?</div>
  <div class="options" id="options"></div>

  <div class="footer">
    <div class="tiny">20 questions fill the bar. Switch language direction anytime.</div>
  </div>

  <!-- ===== CAR CRASH PRACTICE (unchanged) ===== -->
  <section class="practice">
    <h3>üöó Car Crash Practice</h3>
    <div class="p-top">
      <div class="p-info">Score: <span id="pScore">0</span> ¬∑ Hits: <span id="pHits">0</span> ¬∑ Misses: <span id="pMiss">0</span></div>
      <div class="controls">
        <button id="startPractice" class="smallbtn">‚ñ∂ Start</button>
        <button id="stopPractice" class="smallbtn">‚ñ† Stop</button>
        <button id="swapPracticeDir" class="smallbtn">French ‚Üí English</button>
        <button data-speed="slow"  class="modebtn">Slow</button>
        <button data-speed="med"   class="modebtn">Medium</button>
        <button data-speed="fast"  class="modebtn">Fast</button>
      </div>
    </div>
    <div id="arena">
      <div id="bigMission">CRASH INTO THE RIGHT WORD</div>
      <div class="road"></div>
      <div id="car" class="car"></div>
    </div>
    <p class="tiny" style="margin:8px 0 0">Controls: Arrow keys or A/D to steer. Big message shows what to hit.</p>
  </section>

  <!-- ===== MEMORY MATCH (NEW) ===== -->
  <section class="memory">
    <h3>üß† Memory Match (French ‚Üî English)</h3>
    <div class="mem-top">
      <div class="mem-stats">
        Moves: <span id="memMoves">0</span> ¬∑ Matches: <span id="memMatches">0</span>/<span id="memTotal">0</span>
      </div>
      <div class="mem-controls">
        <label class="tiny">Cards:
          <select id="memSize">
            <option value="12">12 (easy)</option>
            <option value="20" selected>20 (normal)</option>
            <option value="28">28 (hard)</option>
            <option value="all">All words (big!)</option>
          </select>
        </label>
        <button id="memStart" class="smallbtn">‚ñ∂ Start</button>
        <button id="memReset" class="smallbtn">‚Üª Reset</button>
      </div>
    </div>
    <div class="tiny" style="margin-top:6px">How to play: Flip two cards. Match a French word with its English word.</div>
    <div id="memGrid"></div>
    <div id="memWin" class="mem-win" style="display:none">Nice! You matched them all üéâ</div>
  </section>
</div>

<script>
/* ===== Shared word list ===== */
const WORDS = [
  {fr:"Carrosse", en:"Carriage"}, {fr:"Citrouille", en:"Pumpkin"}, {fr:"Pantoufle", en:"Slipper"},
  {fr:"Ch√¢teau", en:"Castle"}, {fr:"Minuit", en:"Midnight"}, {fr:"Perdre", en:"To Lose"},
  {fr:"Vilaines", en:"Evil"}, {fr:"Bal", en:"A Ball/Dance"}, {fr:"Baguette Magique", en:"Wand"},
  {fr:"Toujours", en:"Always"}, {fr:"Panier", en:"Basket"}, {fr:"Rencontre", en:"To meet"},
  {fr:"Sourire", en:"Smile"}, {fr:"Vieille", en:"Old"}, {fr:"Tout √† coup", en:"Suddenly"},
  {fr:"Chasseur", en:"Hunter"}, {fr:"Apporter", en:"To bring"}, {fr:"Douce", en:"Sweet"},
  {fr:"Sauver", en:"To save"}, {fr:"Repas", en:"Meal"},
  {fr:"Princesse", en:"Princess"}, {fr:"Aiguille", en:"Needle"}, {fr:"Toucher", en:"To touch"},
  {fr:"Brave", en:"Brave"}, {fr:"Silencieux", en:"Silence"}, {fr:"R√©veiller", en:"To Wake up"},
  {fr:"√âpaisse", en:"Thick"}, {fr:"Endormie", en:"Asleep"}, {fr:"Fort", en:"Strong"},
  {fr:"Heureux", en:"Happy"}, {fr:"Mer", en:"Sea"}, {fr:"Queue", en:"Tail"},
  {fr:"Roi", en:"King"}, {fr:"Bleue Claire", en:"Light Blue"}, {fr:"Sir√®ne", en:"Mermaid"},
  {fr:"Bateau", en:"Boat"}, {fr:"D√©couvrir", en:"To discover"}, {fr:"Oc√©an", en:"Ocean"},
  {fr:"Voix", en:"Voice"}, {fr:"Jambes", en:"Legs"}
];

/* ===== Tiny helpers ===== */
const $ = id => document.getElementById(id);
const shuffle = a => { for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; };

/* ===== TOP QUIZ (unchanged logic, only labels) ===== */
let dir = "FR2EN";
let stars = 0, lives = 3, asked = 0, current = null;

$("dir").onclick = () => {
  dir = dir==="FR2EN" ? "EN2FR" : "FR2EN";
  $("dir").textContent = dir==="FR2EN" ? "French ‚Üí English" : "English ‚Üí French";
  nextQ();
};
$("reset").onclick = () => { stars=0; lives=3; asked=0; updateHUD(); nextQ(); };

function updateHUD(){
  $("stars").textContent = stars;
  $("lives").textContent = lives;
  $("pFill").style.width = Math.min(100, (asked/20)*100) + "%";
}

function nextQ(){
  asked++; updateHUD();
  current = WORDS[Math.floor(Math.random()*WORDS.length)];
  const question = dir==="FR2EN" ? current.fr : current.en;
  const answer   = dir==="FR2EN" ? current.en : current.fr;

  $("prompt").textContent = `Translate: ${question}`;

  const wrongs = shuffle(WORDS.filter(w => (dir==="FR2EN"?w.en:w.fr) !== answer)).slice(0,2)
                  .map(w => dir==="FR2EN" ? w.en : w.fr);
  const choices = shuffle([answer, ...wrongs]);

  const box = $("options"); box.innerHTML = "";
  choices.forEach(choice => {
    const btn = document.createElement("button");
    btn.className = "option bigbtn";
    btn.dataset.choice = choice;
    btn.textContent = choice;
    btn.addEventListener("click", ()=> handleAnswer(choice, answer, btn, box));
    box.appendChild(btn);
  });
}

function handleAnswer(choice, answer, btn, box){
  const buttons = [...box.children]; buttons.forEach(b=>b.disabled=true);
  if(choice === answer){
    btn.classList.add("correct"); stars += 2; confetti(); ding(880);
    setTimeout(()=>{ nextQ(); }, 600);
  }else{
    btn.classList.add("wrong");
    const correctBtn = buttons.find(b => b.dataset.choice === answer);
    if(correctBtn) correctBtn.classList.add("correct");
    lives--; buzz(220);
    if(lives<=0){ setTimeout(()=>{ alert("Game over. Starting again."); $("reset").click(); }, 350); }
    else setTimeout(()=>{ nextQ(); }, 700);
  }
  updateHUD();
}

/* Tiny sounds */
function ding(freq=700){
  try{
    const a=new (window.AudioContext||window.webkitAudioContext)(); const o=a.createOscillator(), g=a.createGain();
    o.type="triangle"; o.frequency.value=freq; o.connect(g); g.connect(a.destination); g.gain.value=.08; o.start();
    setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.00001,a.currentTime+0.05); o.stop(); a.close(); }, 150);
  }catch{}
}
function buzz(freq=200){
  try{
    const a=new (window.AudioContext||window.webkitAudioContext)(); const o=a.createOscillator(), g=a.createGain();
    o.type="square"; o.frequency.value=freq; o.connect(g); g.connect(a.destination); g.gain.value=.06; o.start();
    setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.00001,a.currentTime+0.05); o.stop(); a.close(); }, 180);
  }catch{}
}

/* Confetti (shared) */
const fx = $("fx"); const ctx = fx.getContext("2d");
function size(){ fx.width=innerWidth; fx.height=innerHeight; } addEventListener("resize", size); size();
let parts=[];
function confetti(){
  for(let i=0;i<18;i++){
    parts.push({x:innerWidth*.5, y:120, vx:(Math.random()*6-3), vy:(Math.random()*-6-2), g:.25, a:1, s:3+Math.random()*3, h:Math.floor(Math.random()*360)});
  }
}
function loop(){
  ctx.clearRect(0,0,fx.width,fx.height);
  parts.forEach(p=>{ p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.a-=.02; });
  parts = parts.filter(p=>p.a>0 && p.y<innerHeight+20);
  parts.forEach(p=>{ ctx.globalAlpha=p.a; ctx.fillStyle=`hsl(${p.h} 90% 60%)`; ctx.fillRect(p.x,p.y,p.s,p.s); });
  requestAnimationFrame(loop);
}
loop();

/* ===== CAR CRASH PRACTICE (unchanged logic) ===== */
let pRunning = false;
let pDir = "FR2EN";
let pScore = 0, pHits = 0, pMiss = 0;
let currentMission = null;
let wordEl = null;
let carX = 0;
let carSpeed = 6;
let fallSpeed = 1.2;
let rafId = null;

const arena = $("arena");
const bigMission = $("bigMission");
const car = $("car");

function pickMission(){
  const w = WORDS[Math.floor(Math.random()*WORDS.length)];
  return { ask: pDir==="FR2EN" ? w.fr : w.en, ans: pDir==="FR2EN" ? w.en : w.fr };
}
function setBigMission(){
  bigMission.textContent = `CRASH INTO THE RIGHT WORD: ${currentMission ? currentMission.ask : ""}`;
}
function resetCar(){
  const r = arena.getBoundingClientRect();
  carX = (r.width - 64) / 2;
  car.style.left = carX + "px";
}
function spawnWord(){
  removeWord();
  const correct = Math.random() < 0.5;
  const text = correct
    ? currentMission.ans
    : shuffle(WORDS.map(w => pDir==="FR2EN"?w.en:w.fr).filter(t => t !== currentMission.ans))[0];

  const w = document.createElement("div");
  w.className = "word" + (correct ? "" : " bad");
  w.textContent = text;
  const r = arena.getBoundingClientRect();
  const x = Math.max(6, Math.random()*(r.width - 12 - 80));
  w.style.left = x + "px";
  w.style.top = "-40px";
  w.dataset.correct = correct ? "1" : "0";
  arena.appendChild(w);
  wordEl = w;
}
function removeWord(){ if(wordEl){ wordEl.remove(); wordEl=null; } }

function startPractice(){
  if(pRunning) return;
  pRunning = true;
  pScore = 0; pHits = 0; pMiss = 0; updatePracticeHUD();
  currentMission = pickMission();
  setBigMission();
  resetCar();
  spawnWord();
  loopCar();
}
function stopPractice(){
  pRunning = false;
  cancelAnimationFrame(rafId); rafId = null;
  removeWord();
  setBigMission();
}

$("startPractice").onclick = startPractice;
$("stopPractice").onclick  = stopPractice;
$("swapPracticeDir").onclick = ()=>{
  pDir = pDir==="FR2EN" ? "EN2FR" : "FR2EN";
  $("swapPracticeDir").textContent = pDir==="FR2EN" ? "French ‚Üí English" : "English ‚Üí French";
  if(!pRunning){ currentMission = pickMission(); setBigMission(); }
};
document.querySelectorAll(".modebtn").forEach(b=>{
  b.onclick = ()=>{
    const m = b.dataset.speed;
    if(m==="slow")  fallSpeed = 0.9;
    if(m==="med")   fallSpeed = 1.4;
    if(m==="fast")  fallSpeed = 2.2;
  };
});

function updatePracticeHUD(){
  $("pScore").textContent = pScore;
  $("pHits").textContent  = pHits;
  $("pMiss").textContent  = pMiss;
}

/* Controls: Arrow keys or A/D */
const keys = {left:false, right:false};
window.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft"||e.key==="a"||e.key==="A"){ e.preventDefault(); keys.left=true; }
  if(e.key==="ArrowRight"||e.key==="d"||e.key==="D"){ e.preventDefault(); keys.right=true; }
});
window.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft"||e.key==="a"||e.key==="A"){ keys.left=false; }
  if(e.key==="ArrowRight"||e.key==="d"||e.key==="D"){ keys.right=false; }
});

/* Game loop for practice */
let wordY = -40;
function loopCar(){
  if(!pRunning){ return; }
  const r = arena.getBoundingClientRect();
  carX += (keys.right?carSpeed:0) - (keys.left?carSpeed:0);
  carX = Math.max(2, Math.min(r.width - 66, carX));
  car.style.left = carX + "px";

  if(wordEl){
    wordY = (parseFloat(wordEl.style.top) || -40) + fallSpeed;
    wordEl.style.top = wordY + "px";

    const carRect = car.getBoundingClientRect();
    const wRect = wordEl.getBoundingClientRect();
    const overlap = !(carRect.right < wRect.left || carRect.left > wRect.right || carRect.bottom < wRect.top || carRect.top > wRect.bottom);

    if(overlap){
      const ok = wordEl.dataset.correct === "1";
      kaboomCenter(wordEl, ok ? "‚úÖ" : "‚ùå");
      if(ok){
        pHits++; pScore += 5; currentMission = pickMission(); setBigMission(); confetti();
      }else{
        pMiss++; pScore = Math.max(0, pScore - 2);
      }
      updatePracticeHUD();
      spawnWord();
    }else if(wordY > r.height){
      if(wordEl.dataset.correct === "1"){
        pMiss++; updatePracticeHUD();
        currentMission = pickMission(); setBigMission();
      }
      spawnWord();
    }
  }
  rafId = requestAnimationFrame(loopCar);
}
function kaboomCenter(el, emoji){
  const rA = arena.getBoundingClientRect();
  const r = el.getBoundingClientRect();
  const e = document.createElement("div");
  e.className = "boom";
  e.textContent = emoji;
  e.style.left = (r.left - rA.left + r.width/2 - 14) + "px";
  e.style.top  = (r.top  - rA.top  + r.height/2 - 14) + "px";
  arena.appendChild(e);
  setTimeout(()=>e.remove(), 450);
}

/* ===== MEMORY MATCH GAME ===== */
const memGrid = $("memGrid");
const memMoves = $("memMoves");
const memMatches = $("memMatches");
const memTotal = $("memTotal");
const memWin = $("memWin");
const memSizeSel = $("memSize");
const memStartBtn = $("memStart");
const memResetBtn = $("memReset");

let memDeck = [];
let memFlipped = [];
let memLocked = false;
let memPairsTotal = 0;
let memPairsFound = 0;
let memMoveCount = 0;

memStartBtn.onclick = () => memStart();
memResetBtn.onclick = () => memReset(false);

function memStart(){
  const sizeVal = memSizeSel.value;
  buildDeck(sizeVal);
  renderDeck();
  memReset(true);
}
function memReset(keepDeck){
  memLocked = false;
  memFlipped = [];
  memPairsFound = 0;
  memMoveCount = 0;
  memMatches.textContent = "0";
  memMoves.textContent = "0";
  memWin.style.display = "none";
  if(!keepDeck){
    // rebuild with current size selection
    buildDeck(memSizeSel.value);
    renderDeck();
  } else {
    // just flip all down
    [...memGrid.querySelectorAll(".mem-card")].forEach(c=>{
      c.classList.remove("flipped","matched");
    });
  }
}

function buildDeck(sizeVal){
  let pairCount;
  if(sizeVal === "all"){
    pairCount = WORDS.length; // 38
  }else{
    const cards = parseInt(sizeVal, 10); // total cards
    pairCount = Math.max(2, Math.min(WORDS.length, Math.floor(cards/2)));
  }

  // choose pairCount unique indices
  const indices = shuffle([...Array(WORDS.length).keys()]).slice(0, pairCount);

  const cards = [];
  indices.forEach((idx)=>{
    const w = WORDS[idx];
    cards.push({id:idx, lang:"fr", text:w.fr});
    cards.push({id:idx, lang:"en", text:w.en});
  });

  memDeck = shuffle(cards);
  memPairsTotal = pairCount;
  memTotal.textContent = pairCount.toString();
}

function renderDeck(){
  memGrid.innerHTML = "";
  memDeck.forEach((card, i)=>{
    const wrap = document.createElement("div");
    wrap.className = "mem-card";
    wrap.dataset.id = card.id;
    wrap.dataset.lang = card.lang;

    const btn = document.createElement("button");
    const front = document.createElement("div");
    front.className = "face front";
    front.textContent = "‚ùì";
    const back = document.createElement("div");
    back.className = "face back";
    back.textContent = card.text;

    btn.appendChild(front); btn.appendChild(back);
    wrap.appendChild(btn);
    memGrid.appendChild(wrap);

    btn.addEventListener("click", ()=>{
      if(memLocked || wrap.classList.contains("matched") || wrap.classList.contains("flipped")) return;
      flipCardUp(wrap);
      memFlipped.push(wrap);
      if(memFlipped.length === 2){
        memLocked = true;
        memMoveCount++; memMoves.textContent = memMoveCount.toString();
        checkMatch();
      }
    });
  });
}

function flipCardUp(cardEl){ cardEl.classList.add("flipped"); }
function flipCardDown(cardEl){ cardEl.classList.remove("flipped"); }

function checkMatch(){
  const [a,b] = memFlipped;
  if(!a || !b){ memLocked=false; memFlipped=[]; return; }

  const samePair = a.dataset.id === b.dataset.id;
  const differentLang = a.dataset.lang !== b.dataset.lang;

  if(samePair && differentLang){
    a.classList.add("matched");
    b.classList.add("matched");
    memPairsFound++;
    memMatches.textContent = memPairsFound.toString();
    memFlipped = [];
    memLocked = false;

    if(memPairsFound === memPairsTotal){
      memWin.style.display = "block";
      confetti();
    }
  }else{
    setTimeout(()=>{
      flipCardDown(a);
      flipCardDown(b);
      memFlipped = [];
      memLocked = false;
    }, 650);
  }
}

/* ===== Kick off the first two games as before ===== */
updateHUD(); nextQ();
let currentMission = pickMission(); setBigMission();
window.addEventListener("resize", resetCar);

/* Start a default memory round */
memStart();
</script>
</body>
</html>

